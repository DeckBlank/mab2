{% extends '_html.twig' %}

{% block hero %}
  {% include 'templates-parts/hero.twig' %}
{% endblock %}

{% block content %}
  <section ref="topic" data-id="{{post.id}}" class="c-section c-section--topic">
    <div class="grid-container padding-top-3">
      <div class="grid-x align-center">
        <div class="cell medium-10 large-8">
          <h3 class="fs-25 f2 w-bold dark margin-bottom-2">{{post.title}}</h3>
          <div class="c-details flex-container align-justify margin-bottom-2">
            <div class="flex-container align-middle">
              <figure class="c-avatar margin-right-1 overflow-hidden rounded">
                <img src="{{author.avatar.sizes['thumbnail']}}" alt="">
              </figure>
              <p class="margin-bottom-0 fs-18 f2 dark">{{author.first_name}} {{author.last_name}}</p>
            </div>
            <div class="c-details__label f2 fs-18 flex-container align-middle">
              <span class="c-icon fs-21"><i class="far fa-lock"></i></span>
              <p class="margin-left-1 margin-bottom-0">Contenido pagado</p>
            </div>        
          </div>
          <div class="c-player margin-bottom-1">
            <div style="padding:56.25% 0 0 0;position:relative;"><iframe src="https://player.vimeo.com/video/{{source|split('/')[3]}}?color=de0d46&title=0&byline=0" style="position:absolute;top:0;left:0;width:100%;height:100%;" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe></div>          </div>
          <div class="c-actions flex-container align-justify margin-bottom-3">
            <div class="flex-container align-middle">
              <div class="margin-right-2">
                <Likes :average="likesAverage" :target="{ id : {{post.id}}, type: 'topic' }"></Likes>
              </div>
              <a href="{{summary}}" target="_blank" class="c-download flex-container align-middle">
                <span class="c-icon margin-right-1"><i class="far fa-download"></i></span>
                Descargar resumen
              </a>
            </div>
            <button class="c-questions-toggle c-button c-button--secondary-light flex-container align-middle" @click="isOpenedQuestionsModal = true">
              <p class="margin-bottom-0">Preguntas</p>
            </button>
          </div>
          <div class="c-comments margin-bottom-2">
            <div class="c-counter flex-container align-middle margin-bottom-2">
              <span class="c-counter__icon"><i class="far fa-comment-lines fs-21"></i></span>
              <p v-if="comments.number > 1 || comments.number == 0" class="margin-bottom-0 gray-gray">${comments.number} comentarios</p>
              <p v-else class="margin-bottom-0 gray-gray">${comments.number} comentario</p>
            </div>
            <div class="flex-container margin-bottom-2">
              <div class="margin-right-1">
                <figure class="c-avatar overflow-hidden rounded">
                  <img src="{{theme.link}}/static/images/user.png" alt="">
                </figure>
              </div>
              <div class="width-100">
                <editor :target="{ id: {{post.id}}, type: 'post'}" :post="{ type: 'topic' }" :thread.sync="comments"></editor>
              </div>
            </div>
            <div class="c-loading text-center gray-gray padding-vertical-1" :class="{ hide : !isLoadingComments }">
              Cargando comentarios...
            </div>
            <div class="c-thread">
              <comment v-for="comment of comments.list" :body="comment" :post="{ type: 'topic', id: {{post.id}} }" :key="comment.id" pic="{{theme.link}}/static/images/user.png"></comment>           
              <button v-if="commentsPaged != -1 && comments.list.length != 0 && comments.list.length/commentsPaged >= 5 " class="sec-alt flex-container align-middle" @click="getComments">
                <span class="c-icon margin-right-1"><i class="far fa-ellipsis-h"></i></span> 
                <p class="margin-bottom-0">Mostrar m√°s comentarios</p>
              </button>           
            </div>
          </div>
        </div>
      </div>
    </div>
    <section v-if="questions.length > 0" class="c-modal position-fixed width-100 height-100" :class="{ opened : isOpenedQuestionsModal }">
      <div class="grid-container height-100">
        <div class="grid-x align-center-middle height-100">
          <div class="cell medium-10 large-8">
            <div class="c-modal__content questions br--medium bg-white">
              <div class="flex-container align-right margin-bottom-1">
                <button @click="isOpenedQuestionsModal = false">
                  <span class="c-icon fs-30"><i class="far fa-times"></i></span>
                </button>
              </div>
              <h2 class="f2 fs-25 w-bold dark margin-bottom-2">{{post.title}}</h2>
              <p class="c-questions__progress fs-18 sec-dark text-center margin-bottom-2">
                <span>${currentQuestion}</span> de <span>${questions.length}</span>
              </p>
              <swiper ref="slider_questions" class="c-questions__list margin-bottom-1" :options="swiperOptions">                
                <swiper-slide v-for="(q_, qindex) of questions" :key="q_.id">
                  <h3 class="fs-18 dark margin-bottom-2">${q_.question.title}</h3>                  
                  <ul class="c-question ul-reset">
                    <li 
                      class="c-question__item dark flex-container align-middle margin-bottom-1" 
                      v-for="(o_, oindex) of q_.question.options" :key="o_.id">
                      <input 
                        :id="'option-' + qindex + oindex" 
                        :name="'question-' + qindex"
                        :value="oindex + 1" 
                        type="radio" 
                        class="hide"                       
                        v-model="testResult[qindex].value"
                        @change="verifyOptionSelected(qindex)"
                        :disabled="testResult[qindex].value != ''"
                      >
                      <label 
                        :for="'option-' + qindex + oindex" 
                        class="c-option fs-18 align-middle width-100"
                      >
                        <div class="c-option__checkbox position-relative margin-right-1 rounded">
                        </div>
                        <p class="margin-bottom-0 black">                      
                          ${o_.option}
                        </p>
                      </label>
                    </li>
                  </ul>
                </swiper-slide>
                <swiper-slide>
                  <div class="flex-container flex-dir-column align-center-middle height-100">
                    <p class="sec-alt fs-18 flex-container align-middle">
                      <span class="fs-35 margin-right-1">${totalRightAnswers}</span> Respuesta(s) correctas <span class="c-icon fs-35 margin-left-1"><i class="far fa-check"></i></span>
                    </p>
                    <p class="alert fs-18 flex-container align-middle margin-bottom-0">
                      <span class="fs-35 margin-right-1">${totalWrongAnswers}</span> Respuesta(s) correctas <span class="c-icon fs-35 margin-left-1"><i class="far fa-times"></i></span>
                    </p>
                  </div>
                </swiper-slide>
              </swiper>              
              <div class="flex-container align-middle align-justify">
                <div class="flex-container position-relative width-50">
                  <p class="c-questions__result margin-bottom-0 sec-alt fs-18" :class="{ showed : (testResult[currentQuestion - 1].isRight && !testDone) }">
                    <span class="c-icon margin-right-1"><i class="far fa-check"></i></span>
                    Es correcto
                  </p>
                  <p class="c-questions__result margin-bottom-0 alert fs-18 position-absolute width-100 height-100" :class="{ showed : (!testResult[currentQuestion - 1].isRight && testResult[currentQuestion - 1].value && !testDone) }">
                    <span class="c-icon margin-right-1"><i class="far fa-times"></i></span>
                    Es incorrecto
                  </p>
                </div>
                <button class="c-questions__change flex-container align-center-middle br--medium dark" @click="changeQuestion" :class="{ enable: isEnableChange, hide: testDone }" :disabled="!isEnableChange">
                  <span class="c-icon"><i class="far fa-chevron-right"></i></span>
                </button>
                <button class="c-button bg-light-gray flex-container align-center-middle br--medium dark" @click="restartTest" :class="{ enable: isEnableChange, hide : !testDone }">
                  <span class="c-icon margin-right-1"><i class="far fa-undo-alt"></i></span>Intentar de nuevo
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>    
  </section>
{% endblock %}
